import{_ as We,i as m,N as le,k as Je,I as Xe,c as ae,w as l,r as s,o as B,d as t,g as y,l as Ke,h as Qe,t as oe,p as se,b as q,e as de,F as Ye,f as Ze}from"./index-kmKPHIKf.js";import{g as et,a as Ve}from"./RosLib-C7gnwWt6.js";import{S as tt,C as K,P as nt,W as lt,O as at,A as ot,G as st,d as it,e as rt,h as ut,F as he,i as dt,j as ct}from"./OrbitControls-kCJ6Bck6.js";import{i as mt,L as vt}from"./index-DkaH_rt3.js";var ie={exports:{}},ft=ie.exports,Se;function pt(){return Se||(Se=1,function(ce,me){(function(C,x){ce.exports=x()})(ft,function(){var C=function(){function x(u){return v.appendChild(u.dom),u}function f(u){for(var p=0;p<v.children.length;p++)v.children[p].style.display=p===u?"block":"none";b=u}var b=0,v=document.createElement("div");v.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",v.addEventListener("click",function(u){u.preventDefault(),f(++b%v.children.length)},!1);var k=(performance||Date).now(),F=k,r=0,L=x(new C.Panel("FPS","#0ff","#002")),A=x(new C.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var z=x(new C.Panel("MB","#f08","#201"));return f(0),{REVISION:16,dom:v,addPanel:x,showPanel:f,begin:function(){k=(performance||Date).now()},end:function(){r++;var u=(performance||Date).now();if(A.update(u-k,200),u>F+1e3&&(L.update(1e3*r/(u-F),100),F=u,r=0,z)){var p=performance.memory;z.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return u},update:function(){k=this.end()},domElement:v,setMode:f}};return C.Panel=function(x,f,b){var v=1/0,k=0,F=Math.round,r=F(window.devicePixelRatio||1),L=80*r,A=48*r,z=3*r,u=2*r,p=3*r,R=15*r,M=74*r,E=30*r,g=document.createElement("canvas");g.width=L,g.height=A,g.style.cssText="width:80px;height:48px";var i=g.getContext("2d");return i.font="bold "+9*r+"px Helvetica,Arial,sans-serif",i.textBaseline="top",i.fillStyle=b,i.fillRect(0,0,L,A),i.fillStyle=f,i.fillText(x,z,u),i.fillRect(p,R,M,E),i.fillStyle=b,i.globalAlpha=.9,i.fillRect(p,R,M,E),{dom:g,update:function(w,U){v=Math.min(v,w),k=Math.max(k,w),i.fillStyle=b,i.globalAlpha=1,i.fillRect(0,0,L,R),i.fillStyle=f,i.fillText(F(w)+" "+x+" ("+F(v)+"-"+F(k)+")",z,u),i.drawImage(g,p+r,R,M-r,E,p,R,M-r,E),i.fillRect(p+M-r,R,r,E),i.fillStyle=b,i.globalAlpha=.9,i.fillRect(p+M-r,R,r,F((1-w/U)*E))}}},C})}(ie)),ie.exports}var _t=pt();const xt=et(_t),bt={key:0,class:"stats-panel"},gt={class:"text-grey"},wt={__name:"ScanView",setup(ce){const me={props:{data:Object},template:`
      <div class="stats-display">
        <div class="stat-item">
          <div class="stat-label">点数量</div>
          <div class="stat-value">{{ data.pointCount }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">帧率</div>
          <div class="stat-value">{{ data.fps.toFixed(1) }} FPS</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">最大距离</div>
          <div class="stat-value">{{ data.maxRange.toFixed(2) }}m</div>
        </div>
      </div>
    `},C=m(!1),x=m(!1),f=m(!1),b=m("disconnected"),v=le({url:"ws://localhost:9090",topicName:"/scan"}),k=m("3D"),F=["3D"],r=m(3),L=m(30),A=m(!0),z=m(!0),u=m("distance"),p=m("#42A5F5"),R=m(!1),M=m(5),E=m(!1);let g=null,i=null,w=null,U=null,S=null,Q=null,I=null;const T=m([]),P=le({帧ID:"-",雷达类型:"-",角度范围:"-",角度分辨率:"-",扫描频率:"-",点数量:"-",最小距离:"-",最大距离:"-",更新时间:"-"});let N=null;const ee=le({pointCount:0,fps:0,maxRange:0}),ve=m(!1),j=le({show:!1,text:"",color:"info"}),Y=m(!1),re=m("csv");let G=null;const Z=m([]),W=m(null),fe=m(null);function Re(){if(f.value){pe();return}x.value=!0,b.value="connecting";try{g=new Ve.Ros({url:v.url}),g.on("connection",()=>{f.value=!0,b.value="connected",x.value=!1,J("已连接到ROS","success"),T.value=[],Z.value=[],Ce(),ke()}),g.on("error",n=>{console.error("ROS连接错误:",n),f.value=!1,b.value="disconnected",x.value=!1,J("ROS连接失败","error")}),g.on("close",()=>{f.value=!1,b.value="disconnected",x.value=!1,J("ROS连接已关闭","info")})}catch(n){console.error("ROS连接异常:",n),f.value=!1,b.value="disconnected",x.value=!1,J("ROS连接异常: "+n.message,"error")}}function pe(){i&&(i.unsubscribe(),i=null),g&&(g.close(),g=null),f.value=!1,b.value="disconnected",G&&(cancelAnimationFrame(G),G=null)}function ke(){!g||!f.value||(i=new Ve.Topic({ros:g,name:v.topicName,messageType:"sensor_msgs/LaserScan"}),i.subscribe(n=>{Fe(n)}))}function Fe(n){const e=[];let d=0,V=1/0,_=0;for(let o=0;o<n.ranges.length;o++){const c=n.ranges[o];if(c<n.range_min||c>n.range_max)continue;const D=n.angle_min+o*n.angle_increment,H=n.intensities&&n.intensities[o]?n.intensities[o]:1;e.push({angle:D,range:c,intensity:H}),d++,V=Math.min(V,c),_=Math.max(_,c)}P.帧ID=n.header.seq,P.雷达类型=v.topicName,P.角度范围=`${(n.angle_min*180/Math.PI).toFixed(1)}° 到 ${(n.angle_max*180/Math.PI).toFixed(1)}°`,P.角度分辨率=`${(n.angle_increment*180/Math.PI).toFixed(2)}°`,P.扫描频率=`${(1/n.scan_time).toFixed(1)}Hz`,P.点数量=d,P.最小距离=`${V.toFixed(2)}m`,P.最大距离=`${_.toFixed(2)}m`,P.更新时间=new Date().toLocaleTimeString(),ee.pointCount=d,ee.maxRange=_,R.value?(Z.value.push(e),Z.value.length>M.value&&Z.value.shift(),T.value=[].concat(...Z.value)):T.value=e,Me(e)}function Ce(){Le(),z.value&&(N=new xt,N.dom.style.position="absolute",N.dom.style.top="0px",N.dom.style.right="0px",W.value.appendChild(N.dom)),Ue()}function Le(){const n=W.value,e=n.clientWidth,d=n.clientHeight;w=new tt,w.background=new K(ve.value?1973790:16119285),U=new nt(60,e/d,.1,1e3),U.position.set(0,0,30),S=new lt({antialias:!0}),S.setSize(e,d),S.setPixelRatio(window.devicePixelRatio),n.appendChild(S.domElement),Q=new at(U,S.domElement),Q.enableDamping=!0,Q.dampingFactor=.1;const V=new ot(5);if(w.add(V),A.value){const c=new st(L.value*2,20,new K(5592405),new K(3355443));c.rotateX(Math.PI/2),w.add(c)}const _=new it(16777215,.6);w.add(_);const o=new rt(16777215,.8);o.position.set(10,10,10),w.add(o)}function ze(){const n=fe.value;if(!n)return;I=mt(n,null,{renderer:"canvas"});const e={backgroundColor:"transparent",title:{show:!1},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"20px",containLabel:!0},xAxis:{type:"category",name:"角度(°)",data:[]},yAxis:{type:"value",name:"距离(m)"},series:[{name:"雷达距离",type:"line",sampling:"average",data:[],lineStyle:{width:2,color:"#42A5F5"},areaStyle:{color:new vt(0,0,0,1,[{offset:0,color:"rgba(66, 165, 245, 0.5)"},{offset:1,color:"rgba(66, 165, 245, 0.1)"}])}}]};I.setOption(e)}function Me(n){if(!I)return;const e=[],d=[],V=Math.ceil(n.length/100);for(let _=0;_<n.length;_+=V){const o=n[_];o&&(e.push((o.angle*180/Math.PI).toFixed(1)),d.push(o.range.toFixed(2)))}I.setOption({xAxis:{data:e},series:[{data:d}]})}function Ue(){const n=()=>{G=requestAnimationFrame(n),N&&(N.update(),ee.fps=1/(N.delta||.016)),Q&&Q.update(),Pe()};n()}function Pe(){if(!(!w||!U||!S)){if(w.children.forEach(n=>{n.isPoints&&w.remove(n)}),T.value.length>0){const n=[],e=[];T.value.forEach(o=>{const c=o.range*Math.cos(o.angle),D=o.range*Math.sin(o.angle);if(n.push(c,D,0),u.value==="single"){const O=new K(p.value);e.push(O.r,O.g,O.b)}else if(u.value==="distance"){const O=Math.min(o.range/L.value,1),h=new K;h.setHSL(.6*(1-O),1,.5),e.push(h.r,h.g,h.b)}else if(u.value==="intensity"){const O=Math.min(o.intensity,1),h=new K;h.setHSL(.3*O,1,.5),e.push(h.r,h.g,h.b)}});const d=new ut;d.setAttribute("position",new he(n,3)),d.setAttribute("color",new he(e,3));const V=new dt({size:r.value,vertexColors:!0,sizeAttenuation:!0}),_=new ct(d,V);w.add(_)}S.render(w,U)}}function _e(){if(!W.value)return;const n=W.value,e=n.clientWidth,d=n.clientHeight;S&&U&&(S.setSize(e,d),U.aspect=e/d,U.updateProjectionMatrix()),I&&I.resize()}function De(){const n=W.value;document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():n.requestFullscreen&&n.requestFullscreen()}function J(n,e="info"){j.text=n,j.color=e,j.show=!0}function Ee(){if(!T.value.length){J("没有可导出的数据","warning");return}let n,e,d;switch(re.value){case"csv":n=`angle,range,intensity
`,T.value.forEach(c=>{n+=`${c.angle},${c.range},${c.intensity||0}
`}),e="radar_data.csv",d="text/csv";break;case"json":n=JSON.stringify(T.value,null,2),e="radar_data.json",d="application/json";break;case"png":if(S){const c=S.domElement.toDataURL("image/png"),D=document.createElement("a");D.href=c,D.download="radar_visualization.png",D.click(),Y.value=!1;return}else{J("无法导出图片","error");return}}const V=new Blob([n],{type:d}),_=URL.createObjectURL(V),o=document.createElement("a");o.href=_,o.download=e,o.click(),setTimeout(()=>{URL.revokeObjectURL(_)},100),Y.value=!1}return Je(()=>{ve.value=window.matchMedia("(prefers-color-scheme: dark)").matches,ze(),window.addEventListener("resize",_e)}),Xe(()=>{pe(),window.removeEventListener("resize",_e),G&&cancelAnimationFrame(G),S&&S.dispose(),I&&I.dispose()}),(n,e)=>{const d=s("v-app-bar-title"),V=s("v-spacer"),_=s("v-app-bar"),o=s("v-icon"),c=s("v-card-title"),D=s("v-text-field"),H=s("v-btn"),O=s("v-form"),h=s("v-card-text"),$=s("v-card"),Oe=s("v-select"),ue=s("v-slider"),te=s("v-checkbox"),X=s("v-radio"),xe=s("v-radio-group"),Ae=s("v-color-picker"),be=s("v-expansion-panel-text"),ge=s("v-expansion-panel"),Ie=s("v-expansion-panels"),ne=s("v-col"),Te=s("v-overlay"),Ne=s("v-table"),we=s("v-row"),je=s("v-container"),He=s("v-main"),$e=s("v-snackbar"),Be=s("v-card-actions"),qe=s("v-dialog"),Ge=s("v-app");return B(),ae(Ge,null,{default:l(()=>[t(_,{density:"compact",elevation:"2",color:"primary"},{default:l(()=>[t(d,null,{default:l(()=>e[18]||(e[18]=[y("ROS雷达数据可视化")])),_:1}),t(V),t(Ke(b),{status:b.value},null,8,["status"])]),_:1}),t(He,null,{default:l(()=>[t(je,{fluid:""},{default:l(()=>[t(we,null,{default:l(()=>[t(ne,{cols:"12",md:"3"},{default:l(()=>[t($,{class:"mb-4",elevation:"2"},{default:l(()=>[t(c,{class:"text-h6"},{default:l(()=>[t(o,{start:""},{default:l(()=>e[19]||(e[19]=[y("mdi-connection")])),_:1}),e[20]||(e[20]=y(" 连接设置 "))]),_:1}),t(h,null,{default:l(()=>[t(O,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=a=>C.value=a),onSubmit:Qe(Re,["prevent"])},{default:l(()=>[t(D,{modelValue:v.url,"onUpdate:modelValue":e[0]||(e[0]=a=>v.url=a),label:"Rosbridge URL",placeholder:"ws://localhost:9090",rules:[a=>!!a||"请输入URL"],variant:"outlined",class:"mb-2"},null,8,["modelValue","rules"]),t(D,{modelValue:v.topicName,"onUpdate:modelValue":e[1]||(e[1]=a=>v.topicName=a),label:"雷达Topic名称",placeholder:"/scan",rules:[a=>!!a||"请输入Topic名称"],variant:"outlined",class:"mb-4"},null,8,["modelValue","rules"]),t(H,{block:"",color:"primary",type:"submit",disabled:!C.value,loading:x.value,class:"text-none"},{default:l(()=>[y(oe(f.value?"断开连接":"连接"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),t($,{elevation:"2"},{default:l(()=>[t(c,{class:"text-h6"},{default:l(()=>[t(o,{start:""},{default:l(()=>e[21]||(e[21]=[y("mdi-tune")])),_:1}),e[22]||(e[22]=y(" 可视化设置 "))]),_:1}),t(h,null,{default:l(()=>[t(Oe,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a),items:F,label:"可视化模式",variant:"outlined",class:"mb-2"},null,8,["modelValue"]),t(ue,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),label:"点大小",min:"1",max:"10",step:"0.5","thumb-label":"",class:"mb-2"},null,8,["modelValue"]),t(ue,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=a=>L.value=a),label:"最大显示距离(m)",min:"1",max:"100","thumb-label":"",class:"mb-2"},null,8,["modelValue"]),t(te,{modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=a=>A.value=a),label:"显示网格",class:"mb-2"},null,8,["modelValue"]),t(te,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=a=>z.value=a),label:"显示性能统计",class:"mb-2"},null,8,["modelValue"]),t(Ie,{variant:"accordion"},{default:l(()=>[t(ge,{title:"颜色设置"},{default:l(()=>[t(be,null,{default:l(()=>[t(xe,{modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value=a),inline:""},{default:l(()=>[t(X,{label:"单色",value:"single"}),t(X,{label:"距离渐变",value:"distance"}),t(X,{label:"强度渐变",value:"intensity"})]),_:1},8,["modelValue"]),u.value==="single"?(B(),ae(Ae,{key:0,modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=a=>p.value=a),"hide-inputs":"","hide-canvas":"",class:"ma-2"},null,8,["modelValue"])):se("",!0)]),_:1})]),_:1}),t(ge,{title:"高级设置"},{default:l(()=>[t(be,null,{default:l(()=>[t(te,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=a=>R.value=a),label:"累积扫描",class:"mb-2"},null,8,["modelValue"]),R.value?(B(),ae(ue,{key:0,modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=a=>M.value=a),label:"累积帧数",min:"2",max:"30","thumb-label":"",class:"mb-2"},null,8,["modelValue"])):se("",!0),t(te,{modelValue:E.value,"onUpdate:modelValue":e[12]||(e[12]=a=>E.value=a),label:"显示轨迹",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(ne,{cols:"12",md:"9"},{default:l(()=>[t($,{height:"600",elevation:"2",class:"mb-4 visualization-card"},{default:l(()=>[q("div",{class:"visualization-container",ref_key:"visualizationContainer",ref:W},null,512),t(Te,{"model-value":!f.value,contained:"",persistent:"",class:"align-center justify-center"},{default:l(()=>[t($,{class:"pa-4 text-center",width:"300"},{default:l(()=>[t(o,{size:"64",color:"grey"},{default:l(()=>e[23]||(e[23]=[y("mdi-radar")])),_:1}),e[24]||(e[24]=q("div",{class:"text-h6 mt-2"},"请连接到ROS",-1)),e[25]||(e[25]=q("div",{class:"text-body-2 text-grey"},"请在左侧设置Rosbridge URL和雷达Topic",-1))]),_:1})]),_:1},8,["model-value"]),z.value?(B(),de("div",bt,[t(me,{data:ee},null,8,["data"])])):se("",!0),f.value?(B(),ae(H,{key:1,icon:"mdi-fullscreen",size:"small",class:"fullscreen-button",onClick:De})):se("",!0)]),_:1}),t(we,null,{default:l(()=>[t(ne,{cols:"12",md:"6"},{default:l(()=>[t($,{elevation:"2",height:"300"},{default:l(()=>[t(c,{class:"text-h6"},{default:l(()=>[t(o,{start:""},{default:l(()=>e[26]||(e[26]=[y("mdi-chart-line")])),_:1}),e[27]||(e[27]=y(" 数据分析 "))]),_:1}),q("div",{class:"chart-container",ref_key:"chartContainer",ref:fe},null,512)]),_:1})]),_:1}),t(ne,{cols:"12",md:"6"},{default:l(()=>[t($,{elevation:"2",height:"300"},{default:l(()=>[t(c,{class:"text-h6"},{default:l(()=>[t(o,{start:""},{default:l(()=>e[28]||(e[28]=[y("mdi-information-outline")])),_:1}),e[29]||(e[29]=y(" 雷达信息 "))]),_:1}),t(h,null,{default:l(()=>[t(Ne,{density:"compact"},{default:l(()=>[q("tbody",null,[(B(!0),de(Ye,null,Ze(P,(a,ye)=>(B(),de("tr",{key:ye},[q("td",gt,oe(ye),1),q("td",null,oe(a),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t($e,{modelValue:j.show,"onUpdate:modelValue":e[14]||(e[14]=a=>j.show=a),color:j.color,timeout:3e3},{actions:l(()=>[t(H,{variant:"text",onClick:e[13]||(e[13]=a=>j.show=!1)},{default:l(()=>e[30]||(e[30]=[y("关闭")])),_:1})]),default:l(()=>[y(oe(j.text)+" ",1)]),_:1},8,["modelValue","color"]),t(qe,{modelValue:Y.value,"onUpdate:modelValue":e[17]||(e[17]=a=>Y.value=a),"max-width":"500"},{default:l(()=>[t($,null,{default:l(()=>[t(c,null,{default:l(()=>e[31]||(e[31]=[y("导出数据")])),_:1}),t(h,null,{default:l(()=>[t(xe,{modelValue:re.value,"onUpdate:modelValue":e[15]||(e[15]=a=>re.value=a)},{default:l(()=>[t(X,{label:"CSV",value:"csv"}),t(X,{label:"JSON",value:"json"}),t(X,{label:"图片 (PNG)",value:"png"})]),_:1},8,["modelValue"])]),_:1}),t(Be,null,{default:l(()=>[t(V),t(H,{variant:"text",onClick:e[16]||(e[16]=a=>Y.value=!1)},{default:l(()=>e[32]||(e[32]=[y("取消")])),_:1}),t(H,{color:"primary",onClick:Ee},{default:l(()=>e[33]||(e[33]=[y("导出")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Rt=We(wt,[["__scopeId","data-v-600cd65b"]]);export{Rt as default};
