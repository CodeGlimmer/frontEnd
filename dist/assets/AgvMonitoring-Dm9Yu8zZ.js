import{_ as Fe,H as We,i as p,x as Q,k as Ee,I as Le,e as se,o as C,b as m,a as K,r,c as E,w as t,d as e,p as L,g as i,t as z,q as le,n as we,J as Je,h as De,z as Me,F as je,f as He,L as Ge,M as Ke,A as Oe}from"./index-kmKPHIKf.js";import{R as Pe}from"./RosLib-C7gnwWt6.js";const Qe={class:"ros-video-viewer"},Xe={__name:"RosViewer",props:{wsUrl:{type:String,required:!0},topicName:{type:String,required:!0},startVideo:{type:Boolean,default:!1}},emits:["connection-change","connection-error","viewing-change","topic-error","status-update"],setup(A,{emit:ae}){const s=A,b=ae,_=We("videoCanvas"),f=p("initializing"),R=p(!1);let g=null,k=null;const I=u=>{b("status-update",u)},W=()=>{const u=_.value;if(!u)return;const w=u.getContext("2d");w.fillStyle="#888",w.fillRect(0,0,u.width,u.height),w.fillStyle="#fff",w.font="20px Arial",w.textAlign="center",w.fillText("等待视频画面...",u.width/2,u.height/2)},ne=()=>{if(!s.wsUrl){I("WebSocket URL 不能为空"),f.value="error",b("connection-error",{type:"invalid_url",message:"WebSocket URL 不能为空"});return}g=new Pe.Ros({url:s.wsUrl}),g.on("connection",()=>{f.value="connected",s.startVideo&&V()}),g.on("error",u=>{I(`连接错误: ${u.toString()}`),f.value="error",b("connection-error",{type:"connection_error",message:u.toString()})}),g.on("close",()=>{f.value="closed",h()})},V=()=>{if(!g||f.value!=="connected"){I("无法启动视频流: 未连接到ROS"),b("viewing-change",!1);return}if(!s.topicName){I("无法启动视频流: Topic名称不能为空"),b("topic-error",{type:"empty_topic",message:"Topic名称不能为空"});return}const u=s.topicName.includes("compressed"),w=u?"sensor_msgs/CompressedImage":"sensor_msgs/Image";k=new Pe.Topic({ros:g,name:s.topicName,messageType:w}),k.subscribe($=>{const N=_.value;if(!N)return;const U=N.getContext("2d");if(u){const y=new Image;y.onload=()=>{N.width=y.width,N.height=y.height,U.drawImage(y,0,0)},y.src="data:image/jpeg;base64,"+$.data}else{const{width:y,height:x,data:P}=$,D=U.createImageData(y,x),F=D.data;for(let J=0;J<x;J++)for(let X=0;X<y;X++){const Y=(J*y+X)*3,Z=(J*y+X)*4;F[Z]=P[Y],F[Z+1]=P[Y+1],F[Z+2]=P[Y+2],F[Z+3]=255}N.width=y,N.height=x,U.putImageData(D,0,0)}R.value=!0,b("viewing-change",!0)})},h=()=>{k&&(k.unsubscribe(),k=null),R.value=!1,W()};return Q(()=>s.wsUrl,u=>{u&&ne()}),Q(()=>s.topicName,u=>{R.value&&(h(),u&&f.value==="connected"&&V())}),Q(()=>s.startVideo,u=>{u&&!R.value&&f.value==="connected"?V():!u&&R.value&&h()}),Ee(()=>{W(),s.wsUrl?ne():I("请提供WebSocket URL")}),Le(()=>{h(),g&&(g.close(),g=null)}),(u,w)=>(C(),se("div",Qe,[m("canvas",{ref_key:"videoCanvas",ref:_,class:"video-canvas transition-all duration-300"},null,512)]))}},Ye=Fe(Xe,[["__scopeId","data-v-f5e3a555"]]),Ze={class:"title-text"},et={key:0,class:"video-overlay"},tt={class:"mt-2 overlay-message"},lt={key:0,class:"settings-panel"},at={class:"d-flex align-center"},nt={class:"text-caption text-medium-emphasis status-text"},ot={__name:"RosViewCard",props:{title:{type:String,default:"ROS视频查看器"},wsUrl:{type:String,default:""},topicName:{type:String,default:""},autoStart:{type:Boolean,default:!1},elevation:{type:[Number,String],default:2},variant:{type:String,default:"elevated"},defaultExpanded:{type:Boolean,default:!1},alwaysShowControls:{type:Boolean,default:!1},showSubtitle:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!0},hideOverlay:{type:Boolean,default:!1},savedPresets:{type:Array,default:()=>[]}},emits:["update:wsUrl","update:topicName","update:autoStart","connection-change","connection-error","viewing-change","topic-error","status-update","preset-save","preset-load","fullscreen-change"],setup(A,{emit:ae}){const s=A,b=ae,_=p("initializing"),f=p(!1),R=p(""),g=p(!1),k=p(s.defaultExpanded),I=p(!1),W=p(null),ne=p(null),V=p(s.wsUrl||""),h=p(s.topicName||""),u=p(s.autoStart),w=p("4:3"),$=p(null),N=p([{id:null,name:"选择预设"},...s.savedPresets]),U=p(s.wsUrl||""),y=p(s.topicName||""),x=p(s.autoStart),P=p(!1),D=p(""),F=p({show:!1,text:"",color:"info",timeout:3e3}),J=K(()=>V.value!==U.value||h.value!==y.value||u.value!==x.value),X=K(()=>!!V.value&&J.value),Y=K(()=>{switch(_.value){case"initializing":return"正在连接...";case"connected":return"已连接";case"error":return"连接错误";case"closed":return"连接已关闭";default:return"未连接"}}),Z=K(()=>{switch(_.value){case"initializing":return"mdi-loading mdi-spin";case"connected":return"mdi-check-circle";case"error":return"mdi-alert-circle";case"closed":return"mdi-connection";default:return"mdi-help-circle"}}),he=K(()=>{switch(_.value){case"initializing":return"info";case"connected":return"success";case"error":return"error";case"closed":return"grey";default:return"grey"}}),oe=K(()=>_.value==="initializing"?"正在连接...":_.value==="connected"&&x.value?"正在等待视频流...":_.value==="error"?R.value||"连接错误":_.value==="closed"?"连接已关闭":"视频未启动"),Ue=n=>{_.value=n,b("connection-change",n)},ie=n=>{b("connection-error",n),O(`连接错误: ${n.message}`,"error")},ze=n=>{f.value=n,b("viewing-change",n)},Ie=n=>{b("topic-error",n),O(`Topic错误: ${n.message}`,"error")},ye=n=>{R.value=n,b("status-update",n)},re=async()=>{try{if(!(await ne.value?.validate())?.valid)return}catch(n){console.warn("表单验证错误:",n)}g.value=!0,U.value=V.value,b("update:wsUrl",V.value),setTimeout(()=>{y.value=h.value,x.value=u.value,b("update:topicName",h.value),b("update:autoStart",u.value),g.value=!1},500)},o=()=>{V.value=U.value||"",h.value=y.value||"",u.value=x.value},l=()=>{x.value=!x.value,b("update:autoStart",x.value)},c=()=>{_.value="initializing",x.value=!1,f.value=!1,setTimeout(()=>{const n=U.value;U.value="",setTimeout(()=>{U.value=n||V.value,u.value&&setTimeout(()=>{x.value=!0},1e3)},300)},300)},M=()=>{D.value="",P.value=!0},ee=()=>{if(!D.value)return;const n={id:Date.now().toString(),name:D.value,wsUrl:V.value,topicName:h.value,aspectRatio:w.value,autoConnect:u.value};Array.isArray(N.value)||(N.value=[]),N.value=[{id:null,name:"选择预设"},...N.value.filter(a=>a.id!==null),n],$.value=n.id,P.value=!1,b("preset-save",n),O("预设已保存","success")},B=n=>{if(!n)return;const a=N.value.find(S=>S.id===n);a&&(V.value=a.wsUrl||"",h.value=a.topicName||"",w.value=a.aspectRatio||"4:3",u.value=a.autoConnect,b("preset-load",a),O(`已加载预设: ${a.name}`,"info"))},ue=()=>{if(I.value=!I.value,b("fullscreen-change",I.value),I.value){const n=W.value;n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}else document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},Ne=()=>{const n={wsUrl:U.value,topicName:y.value};navigator.clipboard.writeText(JSON.stringify(n,null,2)).then(()=>{O("连接信息已复制到剪贴板","success")}).catch(()=>{O("复制失败","error")})},O=(n,a="info",S=3e3)=>{F.value={show:!0,text:n,color:a,timeout:S}},q=n=>n?n.startsWith("ws://")||n.startsWith("wss://")||"请输入有效的WebSocket URL (ws:// 或 wss://)":!0;Q(()=>s.wsUrl,n=>{n!==V.value&&(V.value=n||""),n!==U.value&&(U.value=n||"")}),Q(()=>s.topicName,n=>{n!==h.value&&(h.value=n||""),n!==y.value&&(y.value=n||"")}),Q(()=>s.autoStart,n=>{n!==u.value&&(u.value=n),n!==x.value&&(x.value=n)}),Q(()=>s.savedPresets,n=>{n&&Array.isArray(n)&&(N.value=[{id:null,name:"选择预设"},...n])}),Q(w,n=>{const a=W.value;if(!a)return;const S=a.querySelector("canvas");S&&(n==="4:3"?S.style.aspectRatio="4/3":n==="16:9"?S.style.aspectRatio="16/9":S.style.aspectRatio="auto")});const j=()=>{I.value=!!document.fullscreenElement||!!document.webkitFullscreenElement||!!document.msFullscreenElement};return Ee(()=>{document.addEventListener("fullscreenchange",j),document.addEventListener("webkitfullscreenchange",j),document.addEventListener("MSFullscreenChange",j),V.value=s.wsUrl||"",h.value=s.topicName||"",U.value=s.wsUrl||"",y.value=s.topicName||"",u.value=s.autoStart,x.value=s.autoStart,U.value&&_.value!=="connected"&&(_.value="initializing",setTimeout(()=>{_.value==="initializing"&&(_.value="connected")},1e3))}),Le(()=>{document.removeEventListener("fullscreenchange",j),document.removeEventListener("webkitfullscreenchange",j),document.removeEventListener("MSFullscreenChange",j)}),(n,a)=>{const S=r("v-icon"),H=r("v-spacer"),T=r("v-btn"),me=r("v-list-item-title"),de=r("v-list-item"),pe=r("v-list"),Re=r("v-menu"),xe=r("v-card-title"),fe=r("v-card-subtitle"),Se=r("v-card-item"),Ce=r("v-progress-circular"),ge=r("v-divider"),_e=r("v-text-field"),ce=r("v-col"),ke=r("v-row"),Te=r("v-select"),$e=r("v-btn-toggle"),d=r("v-switch"),te=r("v-form"),Ve=r("v-card-text"),be=r("v-card-actions"),G=r("v-expand-transition"),ve=r("v-tooltip"),Ae=r("v-card"),Be=r("v-dialog"),qe=r("v-snackbar");return C(),E(Ae,{class:we(["ros-video-card",{connecting:_.value==="initializing",error:_.value==="error","md3-card":!0}]),elevation:A.elevation,variant:A.variant},{default:t(()=>[e(Se,null,{default:t(()=>[e(xe,{class:"d-flex align-center card-title"},{default:t(()=>[e(S,{class:"mr-2 status-icon",color:he.value},{default:t(()=>[i(z(Z.value),1)]),_:1},8,["color"]),m("span",Ze,z(A.title),1),e(H),A.showMenu?(C(),E(Re,{key:0,transition:"scale-transition",location:"bottom end"},{activator:t(({props:v})=>[e(T,le({icon:"",variant:"text"},v,{density:"comfortable",class:"menu-btn"}),{default:t(()=>[e(S,null,{default:t(()=>a[11]||(a[11]=[i("mdi-dots-vertical")])),_:1})]),_:2},1040)]),default:t(()=>[e(pe,{class:"menu-list"},{default:t(()=>[e(de,{onClick:c,class:"menu-list-item"},{default:t(()=>[e(me,null,{default:t(()=>[e(S,{class:"mr-2",size:"small"},{default:t(()=>a[12]||(a[12]=[i("mdi-refresh")])),_:1}),a[13]||(a[13]=i(" 重新连接 "))]),_:1})]),_:1}),e(de,{onClick:Ne,class:"menu-list-item"},{default:t(()=>[e(me,null,{default:t(()=>[e(S,{class:"mr-2",size:"small"},{default:t(()=>a[14]||(a[14]=[i("mdi-content-copy")])),_:1}),a[15]||(a[15]=i(" 复制连接信息 "))]),_:1})]),_:1}),e(de,{onClick:ue,class:"menu-list-item"},{default:t(()=>[e(me,null,{default:t(()=>[e(S,{class:"mr-2",size:"small"},{default:t(()=>[i(z(I.value?"mdi-fullscreen-exit":"mdi-fullscreen"),1)]),_:1}),i(" "+z(I.value?"退出全屏":"全屏查看"),1)]),_:1})]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1}),A.showSubtitle?(C(),E(fe,{key:0,class:"status-subtitle"},{default:t(()=>[m("span",{class:we({"text-error":_.value==="error"})},z(R.value||Y.value),3)]),_:1})):L("",!0)]),_:1}),m("div",{ref_key:"videoContainer",ref:W,class:we(["video-container",{fullscreen:I.value}])},[e(Ye,{"ws-url":U.value,"topic-name":y.value,"start-video":x.value,onConnectionChange:Ue,onConnectionError:ie,onViewingChange:ze,onTopicError:Ie,onStatusUpdate:ye},null,8,["ws-url","topic-name","start-video"]),e(Je,{name:"fade"},{default:t(()=>[!f.value&&!A.hideOverlay?(C(),se("div",et,[_.value==="initializing"||_.value==="connected"&&x.value?(C(),E(Ce,{key:0,indeterminate:"",color:"primary",size:"64",class:"progress-indicator"})):_.value==="error"?(C(),E(S,{key:1,size:"64",color:"error",class:"status-large-icon"},{default:t(()=>a[16]||(a[16]=[i("mdi-alert-circle")])),_:1})):_.value==="closed"?(C(),E(S,{key:2,size:"64",color:"grey",class:"status-large-icon"},{default:t(()=>a[17]||(a[17]=[i("mdi-video-off")])),_:1})):L("",!0),m("span",tt,z(oe.value),1)])):L("",!0)]),_:1})],2),e(G,null,{default:t(()=>[k.value||A.alwaysShowControls?(C(),se("div",lt,[e(ge),e(Ve,null,{default:t(()=>[e(te,{onSubmit:De(re,["prevent"]),ref_key:"form",ref:ne},{default:t(()=>[e(ke,{dense:""},{default:t(()=>[e(ce,{cols:"12",sm:"6"},{default:t(()=>[e(_e,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=v=>V.value=v),label:"WebSocket URL",hint:"例如: ws://localhost:9090","persistent-hint":"",rules:[v=>!!v||"URL不能为空",q],error:_.value==="error",disabled:g.value,variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-web",clearable:"",class:"md3-field"},null,8,["modelValue","rules","error","disabled"])]),_:1}),e(ce,{cols:"12",sm:"6"},{default:t(()=>[e(_e,{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=v=>h.value=v),label:"Topic 名称",hint:"例如: /camera/image_raw/compressed","persistent-hint":"",rules:[v=>!!v||"Topic不能为空"],variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-camera",clearable:"",class:"md3-field"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(ke,{dense:"",class:"mt-1"},{default:t(()=>[e(ce,{cols:"12",sm:"6"},{default:t(()=>[e(Te,{modelValue:$.value,"onUpdate:modelValue":[a[2]||(a[2]=v=>$.value=v),B],label:"预设",items:N.value,"item-title":"name","item-value":"id",disabled:g.value,variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-bookmark-outline",class:"md3-field"},null,8,["modelValue","items","disabled"])]),_:1}),e(ce,{cols:"12",sm:"6",class:"d-flex align-center"},{default:t(()=>[e($e,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=v=>w.value=v),density:"comfortable",variant:"outlined",class:"mr-2 md3-btn-toggle"},{default:t(()=>[e(T,{value:"4:3",disabled:g.value,class:"ratio-btn"},{default:t(()=>a[18]||(a[18]=[i("4:3")])),_:1},8,["disabled"]),e(T,{value:"16:9",disabled:g.value,class:"ratio-btn"},{default:t(()=>a[19]||(a[19]=[i("16:9")])),_:1},8,["disabled"]),e(T,{value:"auto",disabled:g.value,class:"ratio-btn"},{default:t(()=>a[20]||(a[20]=[i("自动")])),_:1},8,["disabled"])]),_:1},8,["modelValue"]),e(H),m("div",at,[e(d,{modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=v=>u.value=v),label:"自动连接",disabled:g.value,"hide-details":"",density:"comfortable",color:"primary",class:"mr-2 md3-switch"},null,8,["modelValue","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(ge),e(be,null,{default:t(()=>[e(T,{"prepend-icon":"mdi-content-save-outline",variant:"text",disabled:g.value||!J.value,onClick:M,size:"small",class:"md3-btn save-btn"},{default:t(()=>a[21]||(a[21]=[i(" 保存预设 ")])),_:1},8,["disabled"]),e(H),e(T,{variant:"outlined",disabled:g.value,onClick:o,size:"small",class:"md3-btn reset-btn"},{default:t(()=>a[22]||(a[22]=[i(" 重置 ")])),_:1},8,["disabled"]),e(T,{loading:g.value,disabled:!X.value,color:"primary",variant:"elevated",onClick:re,size:"small",class:"md3-btn apply-btn"},{default:t(()=>a[23]||(a[23]=[i(" 应用 ")])),_:1},8,["loading","disabled"])]),_:1})])):L("",!0)]),_:1}),!k.value&&!A.alwaysShowControls?(C(),E(ge,{key:0})):L("",!0),A.alwaysShowControls?L("",!0):(C(),E(be,{key:1,class:"control-actions"},{default:t(()=>[e(ve,{location:"top",text:"视频控制"},{activator:t(({props:v})=>[e(T,le(v,{icon:x.value?"mdi-pause":"mdi-play",disabled:_.value!=="connected",onClick:l,variant:"text",size:"small",class:"control-btn play-btn"}),null,16,["icon","disabled"])]),_:1}),e(ve,{location:"top",text:"重新连接"},{activator:t(({props:v})=>[e(T,le(v,{icon:"mdi-refresh",loading:_.value==="initializing",disabled:g.value,onClick:c,variant:"text",size:"small",class:"control-btn refresh-btn"}),null,16,["loading","disabled"])]),_:1}),e(H),m("span",nt,z(f.value?"视频流已连接":Y.value),1),e(H),e(ve,{location:"top",text:"全屏"},{activator:t(({props:v})=>[e(T,le(v,{icon:I.value?"mdi-fullscreen-exit":"mdi-fullscreen",disabled:!f.value,onClick:ue,variant:"text",size:"small",class:"control-btn fullscreen-btn"}),null,16,["icon","disabled"])]),_:1}),e(ve,{location:"top",text:k.value?"隐藏设置":"显示设置"},{activator:t(({props:v})=>[e(T,le(v,{icon:k.value?"mdi-chevron-up":"mdi-chevron-down",onClick:a[5]||(a[5]=St=>k.value=!k.value),variant:"text",size:"small",class:"control-btn expand-btn"}),null,16,["icon"])]),_:1},8,["text"])]),_:1})),e(Be,{modelValue:P.value,"onUpdate:modelValue":a[8]||(a[8]=v=>P.value=v),"max-width":"400px",transition:"dialog-transition"},{default:t(()=>[e(Ae,{class:"dialog-card"},{default:t(()=>[e(xe,{class:"dialog-title"},{default:t(()=>a[24]||(a[24]=[i("保存预设")])),_:1}),e(Ve,null,{default:t(()=>[e(_e,{modelValue:D.value,"onUpdate:modelValue":a[6]||(a[6]=v=>D.value=v),label:"预设名称",variant:"outlined",density:"comfortable",autofocus:"",rules:[v=>!!v||"预设名称不能为空"],class:"md3-field dialog-field"},null,8,["modelValue","rules"])]),_:1}),e(be,{class:"dialog-actions"},{default:t(()=>[e(H),e(T,{color:"primary",variant:"text",onClick:a[7]||(a[7]=v=>P.value=!1),class:"md3-btn cancel-btn"},{default:t(()=>a[25]||(a[25]=[i(" 取消 ")])),_:1}),e(T,{color:"primary",variant:"elevated",disabled:!D.value,onClick:ee,class:"md3-btn confirm-btn"},{default:t(()=>a[26]||(a[26]=[i(" 保存 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(qe,{modelValue:F.value.show,"onUpdate:modelValue":a[10]||(a[10]=v=>F.value.show=v),color:F.value.color,timeout:F.value.timeout,class:"md3-snackbar"},{actions:t(()=>[e(T,{color:"white",variant:"text",onClick:a[9]||(a[9]=v=>F.value.show=!1),class:"snackbar-btn"},{default:t(()=>a[27]||(a[27]=[i(" 关闭 ")])),_:1})]),default:t(()=>[i(z(F.value.text)+" ",1)]),_:1},8,["modelValue","color","timeout"])]),_:1},8,["elevation","variant","class"])}}},st=Fe(ot,[["__scopeId","data-v-167dcb22"]]),it={class:"d-flex align-center"},rt={key:0,class:"mb-4 mb-sm-6"},ut={class:"d-flex align-center mb-3"},dt={class:"d-flex justify-end mt-4 flex-wrap"},ct={class:"text-center py-4"},vt={class:"d-flex align-center mb-2"},mt={class:"d-flex align-center mb-2"},pt={class:"d-flex align-center"},ft={class:"d-flex align-center mb-2"},gt={class:"d-flex align-center mb-2"},_t={class:"text-caption text-medium-emphasis mt-1"},bt={class:"text-caption text-medium-emphasis mt-4"},wt={class:"d-flex flex-column flex-sm-row"},yt={class:"d-flex align-center"},xt={__name:"AgvMonitoring",setup(A){const ae=p(!1),s=p([]),b=p(!1),_=p(null),f=p(2),R=p("16:9"),g=p(640),k=p(!0),I=[{title:"16:9 (宽屏)",value:"16:9"},{title:"4:3 (标准)",value:"4:3"},{title:"1:1 (正方形)",value:"1:1"},{title:"9:16 (竖屏)",value:"9:16"}],W=o=>{switch(o){case"16:9":return"mdi-television-widescreen";case"4:3":return"mdi-television-classic";case"1:1":return"mdi-crop-square";case"9:16":return"mdi-phone-portrait";default:return"mdi-aspect-ratio"}},ne=K(()=>({gridTemplateColumns:`repeat(${f.value}, 1fr)`,gap:ae.value?"12px":"16px"})),V=K(()=>({maxWidth:k.value?"auto":`${g.value}px`,width:"100%"})),h=K(()=>"auto"),u=p({title:"",wsUrl:"",topicName:"",autoStart:!1,presets:[]}),w=p({show:!1,cardIndex:-1,cardTitle:"",cardId:""}),$=p({show:!1,text:"",color:"success"}),N=()=>{b.value=!0,u.value={title:`ROS视频 ${s.value.length+1}`,wsUrl:"",topicName:"",autoStart:!1,presets:[]},Oe(()=>{const o=document.querySelector(".card-add-form");o&&o.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{const l=document.querySelector(".card-add-form input");l&&l.focus()},300)})},U=async()=>{const{valid:o}=await _.value.validate();o&&(s.value.push({id:Date.now().toString(),title:u.value.title,wsUrl:u.value.wsUrl,topicName:u.value.topicName,autoStart:u.value.autoStart,presets:[],connectionStatus:"closed"}),b.value=!1,oe(`已添加卡片: ${u.value.title}`,"success"),ie())},y=()=>{b.value=!1},x=o=>{o<0||o>=s.value.length||(w.value={show:!0,cardIndex:o,cardTitle:s.value[o].title,cardId:s.value[o].id})},P=()=>{const{cardIndex:o,cardTitle:l,cardId:c}=w.value;if(o>=0&&o<s.value.length){if(s.value[o].id===c)s.value.splice(o,1);else{const M=s.value.findIndex(ee=>ee.id===c);M>=0&&s.value.splice(M,1)}oe(`已删除卡片: ${l}`,"info"),Oe(()=>{ie()})}w.value.show=!1},D=o=>{if(o<0||o>=s.value.length)return;const l=s.value[o],c={...JSON.parse(JSON.stringify(l)),id:Date.now().toString(),title:`${l.title} (复制)`};s.value.push(c),oe(`已复制卡片: ${l.title}`,"success"),ie()},F=(o,l)=>{if(o<0||o>=s.value.length)return;s.value[o].presets||(s.value[o].presets=[]);const c=s.value[o].presets.findIndex(M=>M.id===l.id);c>=0?s.value[o].presets[c]=l:s.value[o].presets.push(l),ie()},J=(o,l)=>{o<0||o>=s.value.length||(s.value[o].connectionStatus=l)},X=o=>{switch(o){case"connected":return"success";case"connecting":return"warning";case"error":return"error";case"closed":default:return"default"}},Y=o=>{switch(o){case"connected":return"mdi-check-circle-outline";case"connecting":return"mdi-progress-clock";case"error":return"mdi-alert-circle-outline";case"closed":default:return"mdi-power-plug-off-outline"}},Z=o=>{switch(o){case"connected":return"已连接";case"connecting":return"连接中";case"error":return"连接错误";case"closed":default:return"未连接"}},he=o=>{switch(o){case"success":return"mdi-check-circle-outline";case"info":return"mdi-information-outline";case"warning":return"mdi-alert-outline";case"error":return"mdi-alert-circle-outline";default:return"mdi-information-outline"}},oe=(o,l="success")=>{$.value={show:!0,text:o,color:l}},Ue=()=>{try{localStorage.setItem("ros-viewer-grid-cols",f.value),localStorage.setItem("ros-viewer-aspect-ratio",R.value),localStorage.setItem("ros-viewer-card-max-width",g.value),localStorage.setItem("ros-viewer-fit-content",JSON.stringify(k.value))}catch(o){console.error("保存布局设置失败:",o)}},ie=()=>{try{localStorage.setItem("ros-viewer-cards",JSON.stringify(s.value))}catch(o){console.error("保存卡片数据失败:",o),oe("保存卡片数据失败","error")}},ze=()=>{try{const o=localStorage.getItem("ros-viewer-cards");o&&(s.value=JSON.parse(o))}catch(o){console.error("加载卡片数据失败:",o),oe("加载卡片数据失败","error")}},Ie=()=>{try{const o=localStorage.getItem("ros-viewer-grid-cols");o&&(f.value=parseInt(o,10));const l=localStorage.getItem("ros-viewer-aspect-ratio");l&&(R.value=l);const c=localStorage.getItem("ros-viewer-card-max-width");c&&(g.value=parseInt(c,10));const M=localStorage.getItem("ros-viewer-fit-content");M!==null&&(k.value=JSON.parse(M))}catch(o){console.error("加载布局设置失败:",o)}},ye=()=>{ae.value=window.innerWidth<600||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};Q([f,R,g,k],()=>{f.value<1&&(f.value=1),f.value>4&&(f.value=4),Ue()});const re=()=>{ye();const o=window.innerWidth;o<600?f.value>1&&(f.value=1):o<960&&f.value>2&&(f.value=2)};return Ee(()=>{ye(),ze(),Ie(),window.addEventListener("resize",re),re()}),Le(()=>{window.removeEventListener("resize",re)}),(o,l)=>{const c=r("v-icon"),M=r("v-spacer"),ee=r("v-slide-x-transition"),B=r("v-btn"),ue=r("v-card-title"),Ne=r("v-divider"),O=r("v-text-field"),q=r("v-col"),j=r("v-switch"),n=r("v-row"),a=r("v-form"),S=r("v-card"),H=r("v-expand-transition"),T=r("v-alert"),me=r("v-scale-transition"),de=r("v-tooltip"),pe=r("v-chip"),Re=r("v-hover"),xe=r("v-fade-transition"),fe=r("v-card-text"),Se=r("v-card-actions"),Ce=r("v-slider"),ge=r("v-list-item-title"),_e=r("v-list-item"),ce=r("v-select"),ke=r("v-dialog"),Te=r("v-snackbar"),$e=r("v-container");return C(),E($e,{fluid:""},{default:t(()=>[e(S,{class:"ros-viewer-container mb-4 card-elevation-transition",variant:"elevated",rounded:"lg",elevation:2},{default:t(()=>[e(ue,{class:"d-flex align-center py-3 py-sm-4 px-4 px-sm-6 flex-wrap"},{default:t(()=>[m("div",it,[e(c,{class:"mr-3 text-primary",size:"28"},{default:t(()=>l[14]||(l[14]=[i("mdi-video-wireless-outline")])),_:1}),l[15]||(l[15]=m("span",{class:"font-weight-bold text-h6"},"ROS视频查看器",-1))]),e(M),e(B,{color:"primary",variant:"tonal","prepend-icon":"mdi-plus",onClick:N,disabled:b.value,size:"small",rounded:"pill",class:"px-4 font-weight-medium btn-transition mt-2 mt-sm-0"},{default:t(()=>[l[17]||(l[17]=i(" 添加视频卡片 ")),e(ee,null,{default:t(()=>[b.value?L("",!0):(C(),E(c,{key:0,class:"ml-1",end:""},{default:t(()=>l[16]||(l[16]=[i("mdi-arrow-down")])),_:1}))]),_:1})]),_:1},8,["disabled"])]),_:1}),e(Ne),e(fe,{class:"pa-3 pa-sm-4"},{default:t(()=>[e(H,null,{default:t(()=>[b.value?(C(),se("div",rt,[e(S,{variant:"outlined",class:"pa-3 pa-sm-4 card-add-form",rounded:"lg",border:"start",color:"primary",elevation:"2"},{default:t(()=>[m("div",ut,[e(c,{color:"primary",class:"mr-2"},{default:t(()=>l[18]||(l[18]=[i("mdi-card-plus-outline")])),_:1}),l[19]||(l[19]=m("span",{class:"text-subtitle-1 font-weight-medium"},"添加新视频卡片",-1))]),e(a,{ref_key:"cardForm",ref:_,onSubmit:De(U,["prevent"])},{default:t(()=>[e(n,{dense:""},{default:t(()=>[e(q,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(O,{modelValue:u.value.title,"onUpdate:modelValue":l[0]||(l[0]=d=>u.value.title=d),label:"卡片标题",variant:"outlined",density:"comfortable",rules:[d=>!!d||"标题不能为空"],"prepend-inner-icon":"mdi-card-text-outline",class:"input-transition"},null,8,["modelValue","rules"])]),_:1}),e(q,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(O,{modelValue:u.value.wsUrl,"onUpdate:modelValue":l[1]||(l[1]=d=>u.value.wsUrl=d),label:"WebSocket URL",variant:"outlined",density:"comfortable",hint:"例如: ws://localhost:9090","persistent-hint":"","prepend-inner-icon":"mdi-web",class:"input-transition"},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(O,{modelValue:u.value.topicName,"onUpdate:modelValue":l[2]||(l[2]=d=>u.value.topicName=d),label:"Topic 名称",variant:"outlined",density:"comfortable",hint:"例如: /camera/image_raw/compressed","persistent-hint":"","prepend-inner-icon":"mdi-message-text-outline",class:"input-transition"},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",sm:"12",md:"6"},{default:t(()=>[e(j,{modelValue:u.value.autoStart,"onUpdate:modelValue":l[3]||(l[3]=d=>u.value.autoStart=d),label:"自动连接",color:"primary","hide-details":"",density:"comfortable","prepend-icon":"mdi-connection",inset:""},null,8,["modelValue"])]),_:1})]),_:1}),m("div",dt,[e(ee,null,{default:t(()=>[e(B,{variant:"outlined",onClick:y,class:"mr-2 mb-2 mb-sm-0 px-4",rounded:"pill",size:"small","prepend-icon":"mdi-close"},{default:t(()=>l[20]||(l[20]=[i(" 取消 ")])),_:1})]),_:1}),e(B,{color:"primary",variant:"elevated",type:"submit",class:"px-5",rounded:"pill",size:"small","prepend-icon":"mdi-check",elevation:3},{default:t(()=>l[21]||(l[21]=[i(" 确认添加 ")])),_:1})])]),_:1},512)]),_:1})])):L("",!0)]),_:1}),e(me,null,{default:t(()=>[s.value.length===0&&!b.value?(C(),E(n,{key:0,class:"mt-2"},{default:t(()=>[e(q,null,{default:t(()=>[e(T,{type:"info",variant:"tonal",border:"start",class:"empty-state-alert pa-4 pa-sm-6",icon:"mdi-video-off-outline"},{default:t(()=>[m("div",ct,[e(c,{size:"48",class:"mb-4 empty-icon"},{default:t(()=>l[22]||(l[22]=[i("mdi-video-off-outline")])),_:1}),l[24]||(l[24]=m("div",{class:"text-subtitle-1 mb-2"},"暂无视频卡片",-1)),l[25]||(l[25]=m("div",{class:"text-body-2 text-medium-emphasis"},' 点击上方"添加视频卡片"按钮开始创建 ',-1)),e(B,{color:"primary",class:"mt-4",variant:"tonal",rounded:"pill","prepend-icon":"mdi-plus",onClick:N,size:"small"},{default:t(()=>l[23]||(l[23]=[i(" 添加第一个视频卡片 ")])),_:1})])]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1}),e(xe,null,{default:t(()=>[s.value.length>0?(C(),se("div",{key:0,class:we(["cards-container",`grid-cols-${f.value}`]),style:Me(ne.value)},[(C(!0),se(je,null,He(s.value,(d,te)=>(C(),se("div",{key:d.id,class:"card-wrapper",style:Me(V.value)},[e(Re,null,{default:t(({isHovering:Ve,props:be})=>[m("div",le({ref_for:!0},be,{class:"h-100"}),[e(st,{title:d.title,"ws-url":d.wsUrl,"topic-name":d.topicName,"auto-start":d.autoStart,"saved-presets":d.presets||[],height:h.value,"aspect-ratio":R.value,onPresetSave:G=>F(te,G),onConnectionChange:G=>J(te,G),class:"video-card"},null,8,["title","ws-url","topic-name","auto-start","saved-presets","height","aspect-ratio","onPresetSave","onConnectionChange"]),m("div",{class:we(["card-actions elevation-4",{"card-actions-visible":Ve||ae.value}])},[e(de,{location:"top",text:"删除卡片"},{activator:t(({props:G})=>[e(B,le({ref_for:!0},G,{icon:"mdi-delete-outline",color:"error",variant:"text",size:"small",onClick:ve=>x(te),class:"card-action-btn"}),null,16,["onClick"])]),_:2},1024),e(de,{location:"top",text:"复制配置"},{activator:t(({props:G})=>[e(B,le({ref_for:!0},G,{icon:"mdi-content-copy",color:"primary",variant:"text",size:"small",onClick:ve=>D(te),class:"card-action-btn"}),null,16,["onClick"])]),_:2},1024)],2),e(pe,{color:X(d.connectionStatus),size:"small",class:"connection-status-chip",variant:"elevated"},{default:t(()=>[e(c,{start:"",size:"small"},{default:t(()=>[i(z(Y(d.connectionStatus)),1)]),_:2},1024),i(" "+z(Z(d.connectionStatus)),1)]),_:2},1032,["color"])],16)]),_:2},1024)],4))),128))],6)):L("",!0)]),_:1})]),_:1}),e(H,null,{default:t(()=>[s.value.length>0?(C(),E(Se,{key:0,class:"px-4 pb-4"},{default:t(()=>[e(M),e(pe,{variant:"tonal",color:"primary",size:"small",class:"font-weight-medium","prepend-icon":"mdi-information-outline"},{default:t(()=>[i(" 共 "+z(s.value.length)+" 个视频卡片 ",1)]),_:1})]),_:1})):L("",!0)]),_:1})]),_:1}),e(S,{class:"mb-4 card-elevation-transition",variant:"elevated",rounded:"lg",elevation:1},{default:t(()=>[e(ue,{class:"py-3 py-sm-4 px-4 px-sm-6 d-flex align-center"},{default:t(()=>[e(c,{class:"mr-3 text-primary",size:"24"},{default:t(()=>l[26]||(l[26]=[i("mdi-view-grid-outline")])),_:1}),l[27]||(l[27]=m("span",{class:"font-weight-bold"},"布局设置",-1))]),_:1}),e(fe,{class:"px-4 px-sm-6 pb-4 pb-sm-6"},{default:t(()=>[e(n,null,{default:t(()=>[e(q,{cols:"12",md:"6"},{default:t(()=>[m("div",vt,[e(c,{class:"mr-2 text-medium-emphasis"},{default:t(()=>l[28]||(l[28]=[i("mdi-view-grid-plus-outline")])),_:1}),l[29]||(l[29]=m("span",{class:"text-subtitle-2"},"每行卡片数量",-1))]),e(Ce,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=d=>f.value=d),min:1,max:4,step:1,"thumb-label":"always",label:"调整每行显示的卡片数量","show-ticks":"always","tick-labels":["1","2","3","4"],color:"primary","track-color":"primary-lighten-3",class:"mt-2 mt-sm-4 slider-transition","hide-details":"auto"},{append:t(()=>[e(ee,null,{default:t(()=>[o.$vuetify.display.smAndDown?L("",!0):(C(),E(O,{key:0,modelValue:f.value,"onUpdate:modelValue":l[4]||(l[4]=d=>f.value=d),type:"number",style:{width:"70px"},density:"compact",variant:"outlined",min:1,max:4,class:"ml-2 ml-sm-4 input-transition","hide-details":""},null,8,["modelValue"]))]),_:1})]),prepend:t(()=>[e(c,{class:"d-none d-sm-flex"},{default:t(()=>l[30]||(l[30]=[i("mdi-view-sequential-outline")])),_:1})]),"append-inner":t(()=>[e(c,{class:"d-none d-sm-flex"},{default:t(()=>l[31]||(l[31]=[i("mdi-view-grid-outline")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"6"},{default:t(()=>[m("div",mt,[e(c,{class:"mr-2 text-medium-emphasis"},{default:t(()=>l[32]||(l[32]=[i("mdi-aspect-ratio")])),_:1}),l[33]||(l[33]=m("span",{class:"text-subtitle-2"},"视频宽高比",-1))]),e(ce,{modelValue:R.value,"onUpdate:modelValue":l[6]||(l[6]=d=>R.value=d),items:I,label:"选择视频显示比例",density:"comfortable",variant:"outlined","prepend-inner-icon":"mdi-television",class:"input-transition"},{selection:t(({item:d})=>[m("div",pt,[e(c,{class:"mr-2",size:"small"},{default:t(()=>[i(z(W(d.value)),1)]),_:2},1024),i(" "+z(d.title),1)])]),item:t(({item:d,props:te})=>[e(_e,Ge(Ke(te)),{prepend:t(()=>[e(c,null,{default:t(()=>[i(z(W(d.value)),1)]),_:2},1024)]),default:t(()=>[e(ge,null,{default:t(()=>[i(z(d.title),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"6"},{default:t(()=>[m("div",ft,[e(c,{class:"mr-2 text-medium-emphasis"},{default:t(()=>l[34]||(l[34]=[i("mdi-resize")])),_:1}),l[35]||(l[35]=m("span",{class:"text-subtitle-2"},"卡片最大宽度",-1))]),e(Ce,{modelValue:g.value,"onUpdate:modelValue":l[8]||(l[8]=d=>g.value=d),min:300,max:1200,step:50,"thumb-label":"always",label:"调整卡片的最大宽度 (像素)",color:"primary","track-color":"primary-lighten-3",class:"mt-2 mt-sm-4 slider-transition","hide-details":"auto"},{"thumb-label":t(({modelValue:d})=>[i(z(d)+"px ",1)]),append:t(()=>[e(ee,null,{default:t(()=>[o.$vuetify.display.smAndDown?L("",!0):(C(),E(O,{key:0,modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=d=>g.value=d),type:"number",style:{width:"90px"},density:"compact",variant:"outlined",min:300,max:1200,step:50,suffix:"px",class:"ml-2 ml-sm-4 input-transition","hide-details":""},null,8,["modelValue"]))]),_:1})]),prepend:t(()=>[e(c,{class:"d-none d-sm-flex"},{default:t(()=>l[36]||(l[36]=[i("mdi-arrow-collapse")])),_:1})]),"append-inner":t(()=>[e(c,{class:"d-none d-sm-flex"},{default:t(()=>l[37]||(l[37]=[i("mdi-arrow-expand")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"6"},{default:t(()=>[m("div",gt,[e(c,{class:"mr-2 text-medium-emphasis"},{default:t(()=>l[38]||(l[38]=[i("mdi-fit-to-screen-outline")])),_:1}),l[39]||(l[39]=m("span",{class:"text-subtitle-2"},"自适应内容",-1))]),e(j,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=d=>k.value=d),label:"自适应内容大小",color:"primary",density:"comfortable",hint:"开启后会根据内容自动调整视频大小","persistent-hint":"","prepend-icon":"mdi-responsive",inset:"",class:"mt-3"},{message:t(()=>[m("div",_t,[e(c,{size:"14",start:""},{default:t(()=>l[40]||(l[40]=[i("mdi-information-outline")])),_:1}),l[41]||(l[41]=i(" 开启后将优先考虑内容显示，忽略最大宽度限制 "))])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ke,{modelValue:w.value.show,"onUpdate:modelValue":l[11]||(l[11]=d=>w.value.show=d),"max-width":"400",transition:"dialog-bottom-transition"},{default:t(()=>[e(S,{rounded:"lg",class:"dialog-card"},{default:t(()=>[e(ue,{class:"d-flex align-center pt-5 pb-2 px-4 px-sm-6"},{default:t(()=>[e(c,{color:"error",class:"mr-3",size:"24"},{default:t(()=>l[42]||(l[42]=[i("mdi-delete-alert")])),_:1}),l[43]||(l[43]=m("span",{class:"text-h6 font-weight-medium"},"确认删除",-1))]),_:1}),e(fe,{class:"px-4 px-sm-6 pb-2 pt-3"},{default:t(()=>[l[47]||(l[47]=m("p",{class:"text-body-1 mb-2"},"您确定要删除以下视频卡片吗？",-1)),e(pe,{color:"primary",variant:"outlined",class:"mt-2 font-weight-medium",size:"large"},{default:t(()=>[e(c,{start:""},{default:t(()=>l[44]||(l[44]=[i("mdi-card-outline")])),_:1}),i(" "+z(w.value.cardTitle),1)]),_:1}),m("div",bt,[e(c,{size:"16",color:"warning",class:"mr-1"},{default:t(()=>l[45]||(l[45]=[i("mdi-alert-circle-outline")])),_:1}),l[46]||(l[46]=i(" 此操作无法撤销 "))])]),_:1}),e(Se,{class:"pa-4 pa-sm-6"},{default:t(()=>[e(M),m("div",wt,[e(B,{variant:"tonal",onClick:l[10]||(l[10]=d=>w.value.show=!1),class:"mb-2 mb-sm-0 mr-0 mr-sm-3 px-5",rounded:"pill","prepend-icon":"mdi-close"},{default:t(()=>l[48]||(l[48]=[i(" 取消 ")])),_:1}),e(B,{color:"error",variant:"elevated",onClick:P,rounded:"pill",class:"px-5","prepend-icon":"mdi-delete-outline"},{default:t(()=>l[49]||(l[49]=[i(" 删除 ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Te,{modelValue:$.value.show,"onUpdate:modelValue":l[13]||(l[13]=d=>$.value.show=d),color:$.value.color,timeout:"3000",location:"top",rounded:"pill",class:"snackbar-transition"},{actions:t(()=>[e(B,{icon:"mdi-close",variant:"text",onClick:l[12]||(l[12]=d=>$.value.show=!1)})]),default:t(()=>[m("div",yt,[e(c,{class:"mr-2",icon:he($.value.color)},null,8,["icon"]),i(" "+z($.value.text),1)])]),_:1},8,["modelValue","color"])]),_:1})}}},Vt=Fe(xt,[["__scopeId","data-v-29796d64"]]);export{Vt as default};
