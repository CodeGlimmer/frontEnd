import{W as gt,_ as _t}from"./WorkingStatus-CTOv4Y7w.js";import{_ as bt,i as r,x as ht,k as xt,y as at,z as St,c as G,w as l,d as a,p as ot,b as o,t as P,r as w,g as b,T as kt,A as U,B as j,e as lt,f as Ct,F as zt,o as V,n as Vt}from"./index-BOH9GfG6.js";import{i as Y,L as nt}from"./index-DkaH_rt3.js";import{R as $}from"./RosLib-C7gnwWt6.js";import{R as Tt}from"./RosViewCard-DnLZ-6q6.js";import"./theme-HQ1WYIhm.js";import"./useSocket-CGAbKkod.js";const Ot={class:"text-subtitle-1 font-weight-medium"},Dt={class:"d-flex align-center"},Ft={class:"carousel-container"},Rt={class:"carousel-indicators"},At=["onClick"],Lt={class:"d-flex align-center"},It={class:"d-flex align-center"},Pt={class:"connection-status"},z=100,$t={__name:"VelocityShow",props:{rosbridgeUrl:{type:String,default:"ws://localhost:9091"},autoPlay:{type:Boolean,default:!0},slideDuration:{type:Number,default:1e4}},setup(W){const T=W,f=["线速度监控","角速度监控","位置追踪"],n=r(0),m=r(!T.autoPlay),_=r(!1),p=r(null),q=r(null),X=r(null),H=r(null);let c=null,u=null,d=null;const x=r([]),S=r([]),h=r([]),y=r([]),g=r([]);let k=0,C=0,O=0,D=null,v=null,F=null,R=null,A=null,L=null;const it=()=>{try{v=new $.Ros({url:T.rosbridgeUrl}),v.on("connection",()=>{console.log("Connected to ROS bridge server"),_.value=!0,p.value=null,st()}),v.on("error",t=>{console.error("Error connecting to ROS bridge server:",t),p.value="连接错误，请检查URL",_.value=!1}),v.on("close",()=>{console.log("Connection to ROS bridge server closed"),_.value=!1,p.value||(p.value="连接已关闭")})}catch(t){console.error("Failed to initialize ROS connection:",t),p.value="初始化失败",_.value=!1}},st=()=>{try{F=new $.Topic({ros:v,name:"/cmd_vel",messageType:"geometry_msgs/Twist"}),F.subscribe(t=>{if(m.value)return;const e=new Date,i=e.toLocaleTimeString("zh-CN",{hour12:!1}),s=Math.sqrt(Math.pow(t.linear.x,2)+Math.pow(t.linear.y,2)+Math.pow(t.linear.z,2));if(x.value.push(s),x.value.length>z&&x.value.shift(),h.value.push(i),h.value.length>z&&h.value.shift(),J(),D!==null){const E=(e-D)/1e3;rt(t.linear.x,t.linear.y,t.angular.z,E)}D=e}),R=new $.Topic({ros:v,name:"/cmd_vel",messageType:"geometry_msgs/Twist"}),R.subscribe(t=>{m.value||(S.value.push(t.angular.z),S.value.length>z&&S.value.shift(),K())});try{A=new $.Topic({ros:v,name:"/pose",messageType:"geometry_msgs/PoseStamped"}),A.subscribe(t=>{if(m.value)return;const e=t.pose;g.value.push([e.position.x,e.position.y]),g.value.length>z&&g.value.shift(),B()})}catch(t){console.warn("Failed to subscribe to pose topic, will use calculated positions only:",t)}}catch(t){console.error("Failed to initialize subscribers:",t),p.value="订阅主题失败"}},rt=(t,e,i,s)=>{O+=i*s,k+=t*Math.cos(O)*s,C+=t*Math.sin(O)*s,y.value.push([k,C]),y.value.length>z&&y.value.shift(),B()},ct=()=>{c=Y(q.value);const t={grid:{top:30,right:20,bottom:30,left:50},tooltip:{trigger:"axis",formatter:"{b}: {c} m/s",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",data:[],axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:"线速度 (m/s)",nameTextStyle:{padding:[0,0,0,40]}},series:[{name:"线速度",type:"line",symbol:"none",sampling:"lttb",lineStyle:{width:2,color:"#1976D2"},areaStyle:{color:new nt(0,0,0,1,[{offset:0,color:"rgba(25, 118, 210, 0.5)"},{offset:1,color:"rgba(25, 118, 210, 0.1)"}])},data:[]}],animation:!0,animationDuration:300};c.setOption(t),u=Y(X.value);const e={grid:{top:30,right:20,bottom:30,left:50},tooltip:{trigger:"axis",formatter:"{b}: {c} rad/s",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",data:[],axisLabel:{rotate:45,fontSize:10}},yAxis:{type:"value",name:"角速度 (rad/s)",nameTextStyle:{padding:[0,0,0,40]}},series:[{name:"角速度",type:"line",symbol:"none",sampling:"lttb",lineStyle:{width:2,color:"#7B1FA2"},areaStyle:{color:new nt(0,0,0,1,[{offset:0,color:"rgba(123, 31, 162, 0.5)"},{offset:1,color:"rgba(123, 31, 162, 0.1)"}])},data:[]}],animation:!0,animationDuration:300};u.setOption(e),d=Y(H.value);const i={grid:{top:30,right:20,bottom:30,left:50},tooltip:{trigger:"item",formatter:function(s){return`坐标: (${s.data[0].toFixed(2)}, ${s.data[1].toFixed(2)})`}},xAxis:{type:"value",name:"X (m)",nameLocation:"middle",nameGap:25},yAxis:{type:"value",name:"Y (m)",nameLocation:"middle",nameGap:35},series:[{name:"计算位置",type:"scatter",symbolSize:8,itemStyle:{color:"#4CAF50"},data:y.value},{name:"实际轨迹",type:"line",symbol:"none",lineStyle:{width:2,color:"#4CAF50",type:"dashed"},data:y.value},{name:"报告位置",type:"scatter",symbolSize:8,itemStyle:{color:"#FF5722"},data:g.value},{name:"报告轨迹",type:"line",symbol:"none",lineStyle:{width:2,color:"#FF5722",type:"solid"},data:g.value},{name:"当前位置",type:"effectScatter",symbolSize:15,showEffectOn:"render",rippleEffect:{brushType:"stroke"},itemStyle:{color:"#2196F3"},data:[[k,C]]}],animation:!0,animationDuration:300};d.setOption(i)},J=()=>{c&&c.setOption({xAxis:{data:h.value},series:[{data:x.value}]})},K=()=>{u&&u.setOption({xAxis:{data:h.value},series:[{data:S.value}]})},B=()=>{d&&d.setOption({series:[{data:y.value},{data:y.value},{data:g.value},{data:g.value},{data:[[k,C]]}]})},ut=()=>{n.value<f.length-1&&(n.value++,I())},dt=()=>{n.value>0&&(n.value--,I())},mt=t=>{n.value=t,I()},I=()=>{at(()=>{n.value===0&&c?c.resize():n.value===1&&u?u.resize():n.value===2&&d&&d.resize()})},Q=()=>{clearInterval(L),!m.value&&(L=setInterval(()=>{n.value<f.length-1?n.value++:n.value=0,I()},T.slideDuration))},pt=()=>{x.value=[],S.value=[],h.value=[],y.value=[],g.value=[],k=0,C=0,O=0,D=null,J(),K(),B()},Z=()=>{c&&c.resize(),u&&u.resize(),d&&d.resize()};return ht(m,t=>{t?clearInterval(L):Q()}),xt(()=>{at(()=>{ct(),it(),Q(),window.addEventListener("resize",Z)})}),St(()=>{clearInterval(L),window.removeEventListener("resize",Z),F&&F.unsubscribe(),R&&R.unsubscribe(),A&&A.unsubscribe(),v&&v.close(),c&&c.dispose(),u&&u.dispose(),d&&d.dispose()}),(t,e)=>{const i=w("v-icon"),s=w("v-btn"),E=w("v-card-title"),vt=w("v-divider"),M=w("v-card-text"),tt=w("v-alert"),et=w("v-spacer"),wt=w("v-card-actions"),ft=w("v-card");return V(),G(ft,{class:"agv-monitor tw:!h-fit tw:!w-fit",elevation:"12"},{default:l(()=>[a(E,{class:"d-flex align-center justify-space-between py-2"},{default:l(()=>[o("span",Ot,P(f[n.value]),1),o("div",Dt,[a(s,{icon:"",variant:"text",size:"small",onClick:e[0]||(e[0]=yt=>m.value=!m.value),color:m.value?"warning":"default"},{default:l(()=>[a(i,null,{default:l(()=>[b(P(m.value?"mdi-play":"mdi-pause"),1)]),_:1})]),_:1},8,["color"]),a(s,{icon:"",variant:"text",size:"small",onClick:pt,color:"error"},{default:l(()=>[a(i,null,{default:l(()=>e[1]||(e[1]=[b("mdi-refresh")])),_:1})]),_:1})])]),_:1}),a(vt),a(M,{class:"pa-2"},{default:l(()=>[o("div",Ft,[a(kt,{name:"slide",tag:"div",class:"carousel-wrapper"},{default:l(()=>[U(o("div",{key:"linear-velocity",class:"chart-container",ref_key:"linearVelocityChart",ref:q},null,512),[[j,n.value===0]]),U(o("div",{key:"angular-velocity",class:"chart-container",ref_key:"angularVelocityChart",ref:X},null,512),[[j,n.value===1]]),U(o("div",{key:"position",class:"chart-container position-chart",ref_key:"positionChart",ref:H},null,512),[[j,n.value===2]])]),_:1}),o("div",Rt,[(V(),lt(zt,null,Ct(f,(yt,N)=>o("div",{key:N,class:Vt(["indicator",{active:n.value===N}]),onClick:jt=>mt(N)},null,10,At)),64))])])]),_:1}),p.value?(V(),G(M,{key:0,class:"error-message text-center pa-0"},{default:l(()=>[a(tt,{variant:"tonal",type:"error",density:"compact",class:"mb-0"},{default:l(()=>[o("div",Lt,[a(i,{start:"",icon:"mdi-access-point-network-off"}),o("span",null,"ROS连接失败: "+P(p.value),1)])]),_:1})]),_:1})):ot("",!0),!p.value&&!_.value?(V(),G(M,{key:1,class:"text-center pa-0"},{default:l(()=>[a(tt,{variant:"tonal",type:"info",density:"compact",class:"mb-0"},{default:l(()=>[o("div",It,[a(i,{start:"",icon:"mdi-loading mdi-spin"}),e[2]||(e[2]=o("span",null,"正在连接ROS服务...",-1))])]),_:1})]),_:1})):ot("",!0),a(wt,{class:"pt-0 px-2 pb-2"},{default:l(()=>[a(et),a(s,{variant:"text",size:"small",color:"primary",disabled:n.value===0,onClick:dt},{default:l(()=>[a(i,{start:""},{default:l(()=>e[3]||(e[3]=[b("mdi-chevron-left")])),_:1}),e[4]||(e[4]=b(" 上一页 "))]),_:1},8,["disabled"]),a(s,{variant:"text",size:"small",color:"primary",disabled:n.value===f.length-1,onClick:ut},{default:l(()=>[e[6]||(e[6]=b(" 下一页 ")),a(i,{end:""},{default:l(()=>e[5]||(e[5]=[b("mdi-chevron-right")])),_:1})]),_:1},8,["disabled"]),a(et)]),_:1}),o("div",Pt,[a(i,{color:_.value?"success":"error",size:"small"},{default:l(()=>[b(P(_.value?"mdi-lan-connect":"mdi-lan-disconnect"),1)]),_:1},8,["color"])])]),_:1})}}},Bt=bt($t,[["__scopeId","data-v-3840e7d2"]]),Et={class:"tw:grid tw:grid-cols-12 tw:gap-2"},Mt={class:"tw:col-span-12 tw:motion-translate-x-in-[-85%] tw:motion-translate-y-in-[-65%] tw:motion-blur-in-[30px] tw:motion-ease-spring-bouncier"},Nt={class:"tw:col-span-12 tw:md:col-span-8 tw:dark:bg-m-grey-darken4 tw:bg-white tw:rounded-xl tw:border-m-success-dark tw:border-l-4 tw:!ml-2.5 tw:flex tw:justify-center tw:items-center tw:motion-translate-x-in-[-85%] tw:motion-translate-y-in-[-65%] tw:motion-blur-in-[30px] tw:motion-ease-spring-bouncier tw:motion-delay-100 tw:shadow-m-elevation-12"},Gt={class:"tw:col-span-12 tw:md:col-span-4 tw:!mx-2.5 tw:!p-2 tw:!md:mx-1 tw:motion-translate-x-in-[-85%] tw:motion-translate-y-in-[-65%] tw:motion-blur-in-[30px] tw:motion-ease-spring-bouncier tw:motion-delay-200 tw:!flex tw:!items-center tw:!justify-center tw:shadow-m-elevation-8 tw:rounded-xl tw:dark:bg-m-grey-darken4"},Ut={class:"tw:col-span-12 tw:md:col-span-3 tw:motion-translate-x-in-[-85%] tw:motion-translate-y-in-[-65%] tw:motion-blur-in-[30px] tw:motion-ease-spring-bouncier tw:motion-delay-300 elevation-8 pa-2 tw:rounded-xl tw:!mx-2 tw:dark:!bg-m-grey-darken4"},Qt={__name:"DashBoard",setup(W){return(T,f)=>(V(),lt("div",Et,[o("div",Mt,[a(gt)]),o("div",Nt,[a(Tt,{class:"tw:w-full tw:!mx-4 tw:hover:!shadow-m-elevation-24 tw:hover:-translate-y-2 tw:transition-transform tw:duration-200 tw:ease-in-out"})]),o("div",Gt,[a(Bt,{class:"tw:hover:-translate-y-2 tw:hover:!shadow-m-elevation-12 tw:ease-in-out tw:!transition-all tw:duration-500 border-thin tw:hover:!bg-m-grey-lighten3 tw:dark:hover:!bg-m-grey-darken3 tw:!w-full"})]),o("div",Ut,[a(_t)]),f[0]||(f[0]=o("div",{class:"tw:col-span-12 tw:md:col-span-9 tw:md:!ml-2 tw:bg-slate-700 tw:rounded-xl tw:!mr-2.5 tw:motion-translate-x-in-[-85%] tw:motion-translate-y-in-[-65%] tw:motion-blur-in-[30px] tw:motion-ease-spring-bouncier tw:motion-delay-500"},[o("div",null,"快速指令")],-1))]))}};export{Qt as default};
